<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>LightweightShutter for RICOH THETA S (1.2)</title>
<script type="text/plain" id="jaTitle">軽量シャッター for RICOH THETA S (1.2)</script>
<script type="text/plain" id="content">
javascript:
(function(g,k,u,w,d,b,n,x,q,t,p,r,i,m,v,a,y,c){
  k='LightweightShutter for '+(g='RICOH THETA S')+' (1.2)';
  u='http://192.168.1.1/osc/';
  if(u.indexOf(document.domain)!=7){
    alert('Run this bookmarklet again after the URL below will be opened. (Wi-Fi connection with '+g+' is required.)\n\n'+(location=u+'info'));
    return;
  }
  w=open();
  d=w.document;
  d.write('
    <meta name="viewport" content="width=320px,initial-scale=1,user-scalable=no">
    <title>'+k+'</title>
    <style>
      body{user-select:none;-webkit-user-select:none;font-family:sans-serif;}
      h1{font:initial;}
      #b{
        position:fixed;top:50%25;left:50%25;transform:translate(-50%25,-50%25);width:300px;height:300px;padding:0;
        border:10px solid #64c832;border-radius:50%25;background:#f0f0f0;color:#757575;font-size:150px;
      }
      #b:active{background:#e1e1e1;}
      #b:disabled{border-color:#757575;}
      #n{position:fixed;right:8px;bottom:8px;}
    </style>
    <h1>'+k+' by <a href="http://twitter.com/shikaku1068" target="_blank">shikaku1068</a></h1>
    <button id="b" disabled>&Theta;</button>
    <div id="n"></div>
  ');
  b=d.getElementById('b');
  n=d.getElementById('n');
  w.onfocus=function(){
    a=1;
    v=0;
  };
  w.onblur=function(){
    a=0;
    b.disabled=1;
  };
  w.ontouchmove=function(e){e.preventDefault();};
  q=[];
  x=new XMLHttpRequest;
  x.timeout=2000;
  x.onloadend=function(){
    if(x.status==200){
      t.s&&t.s(JSON.parse(x.responseText));
    }
    else{
      t.e&&t.e();
    }
    t.f&&t.f();
    t=0;
    q.length&&p();
  };
  p=function(){
    t=q.shift();
    x.open('POST',u+'commands/'+(t.o?'status':'execute'));
    x.setRequestHeader('Content-Type','application/json;charset=utf-8');
    x.setRequestHeader('Accept','application/json');
    x.send(JSON.stringify(t.j));
  };
  r=function(o,j,s,e,f){
    q.push({o:o,j:j,s:s,e:e,f:f});
    t||p();
  };
  c=0;
  b.onclick=function(){
    b.disabled=1;
    r(
      0,{name:'camera.takePicture',parameters:{sessionId:i}},
      function s(o){
        if(o.progress){
          c++;
          n.innerHTML=c;
          w.setTimeout(function(){r(1,{id:o.id},s,0,function(){c--;n.innerHTML=(c?c:'');});},1000);
        }
      },
      function(){c||(v=0);}
    );
    w.setTimeout(function(){v&&(b.disabled=0);},1000);
  };
  b.ontouchend=function(){b.click();};
  (function l(){
    if(a&&!y&&!v){
      y=1;
      r(
        0,{name:'camera.startSession'},
        function(o,r){
          if(r=o.results){
            i=r.sessionId;
            v=1;
            w.clearTimeout(m);
            m=w.setTimeout(function(){v=0;},r.timeout*1000/2);
            b.disabled=0;
          }
        },
        function(){
          v=0;
          b.disabled=1;
        },
        function(){y=0;}
      );
    }
    w.setTimeout(l,1000);
  })();
  setTimeout(function(){
    w.focus();
    a||alert(k+' has been opened in another tab.');
  },1000);
})();
</script>
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-72892673-1', 'auto');
ga('send', 'pageview');
</script>
<script>
var jaFlag = ((navigator.browserLanguage || navigator.language || navigator.userLanguage).match(/^ja\b/i)? true: false);
if(jaFlag) {
  document.title = document.querySelector('#jaTitle').innerHTML;
}
onload = function(event){
  var content = document.querySelector('#content').innerHTML.replace(/^\s+|\s*\n\s*|\s+$/g, '');
  document.body.innerHTML = content;
  prompt(
    (jaFlag? 'テキストを選択してコピーしてください。': 'Select the text and copy it to the clipboard.'),
    content
  );
};
</script>
</head>
<body></body>
</html>
